<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="dev.zeronelab.mybatis.dao.nBoardMapper">
	<!-- 게시물 전체 목록 조회 쿼리 -->
	<select id="selectBoardList"
		resultType="dev.zeronelab.mybatis.vo.nBoardVO">
		<![CDATA[
		select * from nBoard
		ORDER BY regdate DESC
			]]>
	</select>


	<select id="listCriteria"
		resultType="dev.zeronelab.mybatis.vo.nBoardVO">
 <![CDATA[
  SELECT * FROM (
	select 
   		bNo, title, content, writer, regdate, viewCnt , replyCnt,
   		ROW_NUMBER() OVER (ORDER BY bNo DESC, regdate DESC) AS rnum
 	from 
   		nBoard 
 	where bNo > 0 
	 ) WHERE 
    	rnum BETWEEN #{pageStart} AND (#{pageStart} + #{perPageNum} - 1)
 		order by bNo desc, regdate desc limit #{pageStart}, #{perPageNum}
 ]]>
	</select>

	<!-- 검색 조건에 따른 게시물 목록 조회 쿼리 -->
	<select id="listSearch" resultType="dev.zeronelab.mybatis.vo.nBoardVO">
    <![CDATA[
      SELECT * FROM nBoard
      WHERE  bNo > 0     ]]>
		<include refid="search"></include>
	</select>


	<!-- 검색 조건에 따른 게시물 수 조회 쿼리 -->
	<select id="listSearchCount" resultType="int">
      <![CDATA[
    SELECT COUNT(*) FROM nBoard
    WHERE bNo > 0
	  ]]>
	</select>

	<select id="countPaging" resultType="int">
 <![CDATA[
  SELECT COUNT(bNo)
        FROM nBoard
        WHERE bNo > 0 
 ]]>
	</select>

	<!-- 검색 조건 SQL -->
	<sql id="search">
		<if test="searchType != null">
			<if test="searchType == 't'.toString()">
				AND title LIKE '%' || #{keyword} || '%'
			</if>
			<if test="searchType == 'c'.toString()">
				AND content LIKE '%' || #{keyword} || '%'
			</if>
			<if test="searchType == 'w'.toString()">
				AND writer LIKE '%' || #{keyword} || '%'
			</if>
			<if test="searchType == 'tc'.toString()">
				AND (title LIKE '%' || #{keyword} || '%' OR content LIKE
				'%'
				|| #{keyword}
				|| '%')
			</if>
			<if test="searchType == 'cw'.toString()">
				AND (content LIKE '%' || #{keyword} || '%' OR writer LIKE
				'%' ||
				#{keyword} || '%')
			</if>
			<if test="searchType == 'tcw'.toString()">
				AND (title LIKE '%' || #{keyword} || '%' OR content LIKE
				'%'
				|| #{keyword}
				|| '%' OR writer LIKE '%' || #{keyword} || '%')
			</if>
		</if>
	</sql>

	<!-- 글 작성 -->
	<insert id="write">
		<![CDATA[
		insert into nBoard (writer, title, content, viewCnt, replyCnt, regdate)
		values(#{writer}, #{title}, #{content}, #{viewCnt}, #{replyCnt}, SYSDATE)
		]]>
	</insert>


	<!-- 글 조회 -->
	<select id="read" resultType="dev.zeronelab.mybatis.vo.nBoardVO">
		select * 
		from nBoard
		where bNo = #{bNo}
	</select>
</mapper>
